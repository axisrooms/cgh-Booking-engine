{"ast":null,"code":"import _asyncToGenerator from \"/home/dileep/workspace/cgh-Booking-engine/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { forkJoin } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\nimport { BASE_URL, getDefaultHeaders } from '../shared/constants/url.constants';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"src/app/services/bookingid.service\";\nexport class SearchService {\n  constructor(http, BookingConfigService) {\n    this.http = http;\n    this.BookingConfigService = BookingConfigService;\n  }\n\n  getHotels(params) {\n    localStorage.removeItem('reflectStore');\n    return this.http.get(`${BASE_URL}api/be/search`, {\n      params: params,\n      headers: getDefaultHeaders()\n    });\n  }\n\n  getRooms(params) {\n    return this.http.get(`${BASE_URL}api/be/rooms`, {\n      params: params,\n      headers: getDefaultHeaders()\n    });\n  }\n\n  getRoomPrices(params) {\n    params.rooms = 1;\n    return this.http.get(`${BASE_URL}api/be/finalPrices`, {\n      params: params,\n      headers: getDefaultHeaders()\n    });\n  }\n\n  searchRooms(params) {\n    return this.getHotels(params).pipe(mergeMap(data => this.getRoomData(data)));\n  }\n\n  getRoomData(data) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      var _a;\n\n      let roomObservables = (_a = data['Hotel_Details']) === null || _a === void 0 ? void 0 : _a.map(e => {\n        let params = {};\n        params['bookingEngineId'] = _this.BookingConfigService.getBookingEngineId();\n        params['searchId'] = data['search_id'];\n        params['productId'] = e.hotel_id;\n        return _this.getRooms(params).pipe(map(roomData => {\n          var _a;\n\n          for (let i = 0; i < ((_a = data['Hotel_Details']) === null || _a === void 0 ? void 0 : _a.length); i++) {\n            if (roomData['HotelDetails'][0]['hotelId'] === data['Hotel_Details'][i]['hotel_id']) {\n              data['Hotel_Details'][i]['rooms'] = roomData['HotelDetails'][0]['rooms'];\n              break;\n            }\n          }\n        }));\n      });\n\n      if (roomObservables) {\n        yield forkJoin(roomObservables).toPromise();\n        data['Hotel_Details'] = data['Hotel_Details'].filter(e => e['rooms'] != undefined);\n      }\n\n      return data;\n    })();\n  }\n\n  getAllHotels(date) {\n    return this.http.get(`${BASE_URL}api/be/search`, {\n      params: {\n        bookingEngineId: this.BookingConfigService.getBookingEngineId(),\n        checkin: date\n      },\n      headers: getDefaultHeaders()\n    });\n  }\n\n}\n\nSearchService.ɵfac = function SearchService_Factory(t) {\n  return new (t || SearchService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.BookingConfigService));\n};\n\nSearchService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: SearchService,\n  factory: SearchService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["/home/dileep/workspace/cgh-Booking-engine/src/app/services/search.service.ts"],"names":["forkJoin","map","mergeMap","BASE_URL","getDefaultHeaders","i0","i1","i2","SearchService","constructor","http","BookingConfigService","getHotels","params","localStorage","removeItem","get","headers","getRooms","getRoomPrices","rooms","searchRooms","pipe","data","getRoomData","_a","roomObservables","e","getBookingEngineId","hotel_id","roomData","i","length","toPromise","filter","undefined","getAllHotels","date","bookingEngineId","checkin","ɵfac","SearchService_Factory","t","ɵɵinject","HttpClient","ɵprov","ɵɵdefineInjectable","token","factory","providedIn"],"mappings":"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","sourcesContent":["import { forkJoin } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\nimport { BASE_URL, getDefaultHeaders, } from '../shared/constants/url.constants';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"src/app/services/bookingid.service\";\nexport class SearchService {\n    constructor(http, BookingConfigService) {\n        this.http = http;\n        this.BookingConfigService = BookingConfigService;\n    }\n    getHotels(params) {\n        localStorage.removeItem('reflectStore');\n        return this.http.get(`${BASE_URL}api/be/search`, {\n            params: params,\n            headers: getDefaultHeaders(),\n        });\n    }\n    getRooms(params) {\n        return this.http.get(`${BASE_URL}api/be/rooms`, {\n            params: params,\n            headers: getDefaultHeaders(),\n        });\n    }\n    getRoomPrices(params) {\n        params.rooms = 1;\n        return this.http.get(`${BASE_URL}api/be/finalPrices`, {\n            params: params,\n            headers: getDefaultHeaders(),\n        });\n    }\n    searchRooms(params) {\n        return this.getHotels(params).pipe(mergeMap((data) => this.getRoomData(data)));\n    }\n    async getRoomData(data) {\n        var _a;\n        let roomObservables = (_a = data['Hotel_Details']) === null || _a === void 0 ? void 0 : _a.map((e) => {\n            let params = {};\n            params['bookingEngineId'] = this.BookingConfigService.getBookingEngineId();\n            params['searchId'] = data['search_id'];\n            params['productId'] = e.hotel_id;\n            return this.getRooms(params).pipe(map((roomData) => {\n                var _a;\n                for (let i = 0; i < ((_a = data['Hotel_Details']) === null || _a === void 0 ? void 0 : _a.length); i++) {\n                    if (roomData['HotelDetails'][0]['hotelId'] ===\n                        data['Hotel_Details'][i]['hotel_id']) {\n                        data['Hotel_Details'][i]['rooms'] =\n                            roomData['HotelDetails'][0]['rooms'];\n                        break;\n                    }\n                }\n            }));\n        });\n        if (roomObservables) {\n            await forkJoin(roomObservables).toPromise();\n            data['Hotel_Details'] = data['Hotel_Details'].filter((e) => e['rooms'] != undefined);\n        }\n        return data;\n    }\n    getAllHotels(date) {\n        return this.http.get(`${BASE_URL}api/be/search`, {\n            params: { bookingEngineId: this.BookingConfigService.getBookingEngineId(), checkin: date, },\n            headers: getDefaultHeaders(),\n        });\n    }\n}\nSearchService.ɵfac = function SearchService_Factory(t) { return new (t || SearchService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.BookingConfigService)); };\nSearchService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: SearchService, factory: SearchService.ɵfac, providedIn: 'root' });\n"]},"metadata":{},"sourceType":"module"}