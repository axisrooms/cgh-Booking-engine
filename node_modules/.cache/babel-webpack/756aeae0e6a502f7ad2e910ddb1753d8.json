{"ast":null,"code":"import _asyncToGenerator from \"/home/dileep/workspace/cgh-Booking-engine/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { debounceTime, map, startWith } from 'rxjs/operators';\nimport * as moment from 'moment';\nimport { DateRange } from '@angular/material/datepicker';\nimport { DropdownType } from 'src/app/shared/models/dropdown-type';\nimport { formatDate } from '@angular/common';\nlet SearchComponent = class SearchComponent {\n  constructor(searchService, formBuilder, activatedRoute, router, spinner, dealsService, bookingService, bookingConfigService) {\n    this.searchService = searchService;\n    this.formBuilder = formBuilder;\n    this.activatedRoute = activatedRoute;\n    this.router = router;\n    this.spinner = spinner;\n    this.dealsService = dealsService;\n    this.bookingService = bookingService;\n    this.bookingConfigService = bookingConfigService;\n    this.dropdownType = DropdownType;\n    this.showDropdown = DropdownType.none;\n    this.showFieldWarnings = DropdownType.none;\n    this.age = new Map();\n    this.agesArray = Array.from({\n      length: 17\n    }, (_, i) => i + 1);\n    this.hotelsList = [];\n    this.isHotelListLoaded = false;\n    this.locationList = [];\n    this.isCurrentCalendarInputCheckout = false;\n    this.bookingItems = [];\n    this.selectedRangeValueChange = new EventEmitter();\n    this.now = new Date();\n    this.secondCalStartDate = new Date(this.now.getFullYear(), this.now.getMonth() + 1, 1);\n    this.calendarOneHeading = null;\n    this.calendarTwoHeading = null;\n    this.dateRangeSelectionType = 'exact';\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    this.bookingCart$ = this.bookingService.bookingCart$;\n    this.bookingCart$.subscribe(res => {\n      var _a;\n\n      this.bookingItems = (_a = res === null || res === void 0 ? void 0 : res.bookingItems) !== null && _a !== void 0 ? _a : [];\n    });\n    this.minDate = new Date();\n    this.searchForm = this.createSearchForm();\n    this.getWithExpiry();\n    this.filteredHotelsList = this.searchForm.controls.hotel.valueChanges.pipe(startWith(''), map(value => this.filterHotel(value)));\n    this.filteredLocationList = this.searchForm.controls.hotel.valueChanges.pipe(startWith(''), map(value => this.filterLocation(value)));\n    this.activateRouteSubscription$ = this.activatedRoute.queryParams.pipe(debounceTime(300)).subscribe( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (queryParams) {\n        var _a, _b;\n\n        if (!queryParams['checkIn']) localStorage.removeItem('reflectStore');\n\n        if (queryParams['checkIn']) {\n          _this.roomCount = queryParams['rooms'];\n\n          _this.searchForm.patchValue({\n            checkIn: queryParams['checkIn'],\n            checkOut: queryParams['checkOut'],\n            cityId: (_a = queryParams['cityId']) !== null && _a !== void 0 ? _a : '',\n            stateId: queryParams['stateId'],\n            countryId: queryParams['countryId'],\n            searchType: (_b = queryParams['searchType']) !== null && _b !== void 0 ? _b : 'hotel'\n          });\n\n          yield _this.setHotelName(parseInt(queryParams['productId']));\n\n          _this.setLocation(queryParams['cityId'], queryParams['stateId']);\n\n          _this.setPaxInfo(queryParams['paxInfo']);\n\n          _this.fetchSearchResult();\n\n          const roomsFromStorage = Number(localStorage.getItem('rooms'));\n\n          if (!isNaN(roomsFromStorage) && roomsFromStorage > 0) {\n            _this.searchForm.controls.rooms.setValue(roomsFromStorage);\n          }\n        }\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  }\n\n  ngOnDestroy() {\n    var _a;\n\n    (_a = this.activateRouteSubscription$) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n  }\n\n  createSearchForm() {\n    let dt = formatDate(new Date(), 'dd/MM/yyyy', 'en');\n    const tomorrow = new Date();\n    tomorrow.setDate(tomorrow.getDate() + 1);\n    let dtTom = formatDate(tomorrow, 'dd/MM/yyyy', 'en');\n    return this.formBuilder.group({\n      searchType: ['hotel'],\n      hotel: [''],\n      location: [''],\n      cityId: [''],\n      stateId: [''],\n      countryId: [''],\n      checkIn: [dt, Validators.required],\n      checkOut: [dtTom, Validators.required],\n      rooms: [1],\n      paxData: this.formBuilder.array([this.formBuilder.group({\n        noOfAdults: 1,\n        noOfChildren: 0\n      })])\n    });\n  }\n\n  getTablesFormArray() {\n    return this.searchForm.get('paxData');\n  }\n  /* ----------------- Missing helper methods requested by template ----------------- */\n\n\n  focusDestinationFieldInput(type) {\n    var _a, _b;\n\n    if (type === 'hotel') {\n      (_a = document.getElementById('hotel-field-input')) === null || _a === void 0 ? void 0 : _a.focus();\n    } else {\n      (_b = document.getElementById('location-field-input')) === null || _b === void 0 ? void 0 : _b.focus();\n    }\n\n    this.showFieldWarnings = DropdownType.none;\n  }\n\n  changeSearchType(val) {\n    this.searchForm.controls.searchType.setValue(val);\n\n    if (val === 'hotel') {\n      this.searchForm.controls.hotel.setValidators([Validators.required]);\n      this.searchForm.controls.location.clearValidators();\n    } else if (val === 'location') {\n      this.searchForm.controls.location.setValidators([Validators.required]);\n      this.searchForm.controls.hotel.clearValidators();\n    }\n\n    this.searchForm.controls.hotel.updateValueAndValidity();\n    this.searchForm.controls.location.updateValueAndValidity();\n  }\n\n  onHotelFieldEvent(type, event) {\n    if (!this.isHotelListLoaded) {\n      this.getWithExpiry();\n    }\n\n    if (type === 'focus' || type === 'keydown') {\n      this.filterHotel(this.searchForm.controls.hotel.value);\n      this.filterLocation(this.searchForm.controls.hotel.value);\n    }\n  }\n\n  setDateRangeSelectionType(val) {\n    this.dateRangeSelectionType = val;\n  }\n  /* ------------------------------------------------------------------------------- */\n\n  /** ---------- HOTEL FILTERING ---------- */\n\n\n  filterHotel(value) {\n    this.getWithExpiry();\n    if (!value) value = '';\n    let filterValue = (value || '').toString().toLowerCase();\n    let filtered = this.hotelsList.filter(val => {\n      var _a;\n\n      return (_a = val.hotel_name) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes(filterValue);\n    });\n    this.showDropdown = filtered.length > 0 ? DropdownType.hotel : DropdownType.none;\n    return filtered;\n  }\n  /** ---------- LOCATION FILTERING ---------- */\n\n\n  filterLocation(value) {\n    this.getWithExpiry();\n    if (!value) value = '';\n    let filterValue = (value || '').toString().toLowerCase();\n    let filtered = this.locationList.filter(val => {\n      var _a;\n\n      return (_a = val.key) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes(filterValue);\n    });\n    this.showDropdown = filtered.length > 0 ? DropdownType.location : DropdownType.none;\n    return filtered;\n  }\n  /** ---------- CACHE ---------- */\n\n\n  setWithExpiry(value) {\n    const item = {\n      value,\n      expiry: new Date().getTime()\n    };\n    localStorage.setItem('hotel', JSON.stringify(item));\n  }\n\n  getAllHotels() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this2.searchService.getAllHotels().toPromise().then(res => {\n        _this2.setWithExpiry(res['Hotel_Details']);\n\n        _this2.getWithExpiry();\n      }).catch(err => console.error(err));\n    })();\n  }\n\n  getWithExpiry() {\n    const itemStr = localStorage.getItem('hotel');\n    if (this.flag == null) this.flag = true;\n\n    if (!itemStr && this.flag) {\n      this.getAllHotels();\n      this.flag = false;\n      return;\n    }\n\n    if (itemStr && this.flag) {\n      let item = JSON.parse(itemStr);\n\n      if (new Date().getTime() > item.expiry) {\n        localStorage.removeItem('hotel');\n        this.getAllHotels();\n        this.flag = false;\n        return;\n      }\n\n      this.hotelsList = item.value;\n      this.getLocationList(item.value);\n      this.isHotelListLoaded = true;\n    }\n  }\n  /** ---------- LOCATION LIST ---------- */\n\n\n  getLocationList(list) {\n    list.forEach(e1 => {\n      var _a, _b;\n\n      if ((_a = e1.address) === null || _a === void 0 ? void 0 : _a.city) {\n        let cityObj = {\n          key: e1.address.city,\n          type: 'city',\n          cityId: e1.address.cityId,\n          state: e1.address.state,\n          stateId: e1.address.stateId,\n          country: e1.address.country,\n          countryId: e1.address.countryId\n        };\n        if (!this.locationList.find(x => x.key === cityObj.key)) this.locationList.push(cityObj);\n      }\n\n      if ((_b = e1.address) === null || _b === void 0 ? void 0 : _b.state) {\n        let stateObj = {\n          key: e1.address.state,\n          type: 'state',\n          stateId: e1.address.stateId,\n          country: e1.address.country,\n          countryId: e1.address.countryId\n        };\n        if (!this.locationList.find(x => x.key === stateObj.key)) this.locationList.push(stateObj);\n      }\n    });\n  }\n  /** ---------- DROPDOWNS ---------- */\n\n\n  toggleDropdown(type) {\n    this.showDropdown = this.showDropdown !== type ? type : DropdownType.none;\n    this.showFieldWarnings = DropdownType.none;\n\n    if (type === DropdownType.checkin || type === DropdownType.checkout) {\n      this.updateHeaderText();\n    }\n  }\n  /** ---------- ROOMS & GUESTS ---------- */\n\n\n  updateRoomCount(type) {\n    let rooms = this.searchForm.controls.rooms.value;\n\n    if (type === 'decrement' && rooms > 1) {\n      this.searchForm.controls.rooms.setValue(rooms - 1);\n      this.getTablesFormArray().removeAt(rooms - 1);\n    }\n\n    if (type === 'increment') {\n      this.searchForm.controls.rooms.setValue(rooms + 1);\n      this.getTablesFormArray().push(this.formBuilder.group({\n        noOfAdults: 1,\n        noOfChildren: 0\n      }));\n    }\n\n    localStorage.setItem('rooms', this.searchForm.controls.rooms.value.toString());\n  }\n\n  updateAdultCount(type, index) {\n    let room = this.getTablesFormArray().at(index);\n    let current = room.value.noOfAdults;\n    if (type === 'increment') room.patchValue({\n      noOfAdults: current + 1\n    });\n    if (type === 'decrement' && current > 1) room.patchValue({\n      noOfAdults: current - 1\n    });\n  }\n\n  updateChildCount(type, index) {\n    let room = this.getTablesFormArray().at(index);\n    let current = room.value.noOfChildren;\n\n    if (type === 'increment' && current < 3) {\n      room.patchValue({\n        noOfChildren: current + 1\n      });\n      this.age.set(`${index}_${current}`, 1);\n    }\n\n    if (type === 'decrement' && current > 0) {\n      room.patchValue({\n        noOfChildren: current - 1\n      });\n      this.age.delete(`${index}_${current - 1}`);\n    }\n  }\n\n  addAges(event, room, child) {\n    this.age.set(`${room}_${child}`, event.target.value);\n  }\n  /** ---------- SELECTION ---------- */\n\n\n  selectHotel(name) {\n    this.searchForm.controls.hotel.setValue(name);\n    this.showDropdown = DropdownType.none;\n  }\n\n  selectLocation(option) {\n    var _a;\n\n    this.searchForm.patchValue({\n      hotel: option.key,\n      cityId: (_a = option.cityId) !== null && _a !== void 0 ? _a : '',\n      stateId: option.stateId,\n      countryId: option.countryId,\n      location: option.key,\n      searchType: 'location'\n    });\n    this.showDropdown = DropdownType.none;\n  }\n\n  setHotelName(id) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      _this3.getWithExpiry();\n\n      let match = _this3.hotelsList.find(h => h.hotel_id === id);\n\n      if (match) _this3.searchForm.controls.hotel.setValue(match.hotel_name);\n    })();\n  }\n\n  setLocation(cityId, stateId) {\n    let location = '';\n\n    for (let loc of this.locationList) {\n      if (cityId && loc.cityId === cityId) location = loc.key;else if (!cityId && loc.stateId === stateId) location = loc.key;\n    }\n\n    this.searchForm.controls.location.setValue(location);\n  }\n  /** ---------- PAX INFO ---------- */\n\n\n  getPaxInfo() {\n    let paxString = '';\n    let guests = 0;\n    let arr = this.getTablesFormArray().value;\n\n    for (let i = 0; i < arr.length; i++) {\n      paxString += arr[i].noOfAdults + '|' + arr[i].noOfChildren + '|';\n      guests += arr[i].noOfAdults + arr[i].noOfChildren;\n\n      for (let c = 0; c < arr[i].noOfChildren; c++) {\n        paxString += this.age.get(`${i}_${c}`) + '|';\n      }\n\n      paxString += '|';\n    }\n\n    localStorage.setItem('guests', guests.toString());\n    return paxString;\n  }\n\n  setPaxInfo(info) {// optional (not implemented in original code)\n  }\n  /** ---------- SUBMIT / SEARCH ---------- */\n\n\n  onSubmit() {\n    this.searchForm.markAllAsTouched();\n    this.showDropdown = DropdownType.none;\n\n    if (this.searchForm.valid) {\n      let prevUrl = this.router.url;\n      let params = this.getSearchParams();\n      params.searchType = this.searchForm.controls.searchType.value;\n      this.router.navigate(['/search'], {\n        queryParams: params\n      }).then(res => {\n        if (prevUrl === this.router.url) this.scrollToSearchView();\n      });\n    } else {\n      // show validation warnings if needed\n      if (this.searchForm.controls.hotel.invalid && (this.searchForm.controls.hotel.dirty || this.searchForm.controls.hotel.touched)) {\n        this.showFieldWarnings = DropdownType.hotel;\n      } else if (this.searchForm.controls.checkIn.invalid && (this.searchForm.controls.checkIn.dirty || this.searchForm.controls.checkIn.touched)) {\n        this.showFieldWarnings = DropdownType.checkin;\n      } else if (this.searchForm.controls.checkOut.invalid && (this.searchForm.controls.checkOut.dirty || this.searchForm.controls.checkOut.touched)) {\n        this.showFieldWarnings = DropdownType.checkout;\n      }\n    }\n  }\n\n  getSearchParams() {\n    let params = {\n      bookingEngineId: this.bookingConfigService.getBookingEngineId ? this.bookingConfigService.getBookingEngineId() : undefined,\n      hotelId: this.bookingConfigService.getBookingEngineId ? this.bookingConfigService.getBookingEngineId() : undefined\n    };\n    params.productId = this.getProductId();\n    params.cityId = this.searchForm.controls.cityId.value;\n    params.checkIn = this.searchForm.controls.checkIn.value;\n    params.checkOut = this.searchForm.controls.checkOut.value;\n    params.paxInfo = this.getPaxInfo();\n    return params;\n  }\n\n  getProductId() {\n    var _a;\n\n    let name = this.searchForm.controls.hotel.value;\n    let hotel = this.hotelsList.find(h => h.hotel_name === name);\n    return (_a = hotel === null || hotel === void 0 ? void 0 : hotel.hotel_id) !== null && _a !== void 0 ? _a : null;\n  }\n\n  fetchSearchResult() {\n    if (!this.searchForm.valid) return;\n    this.spinner.show();\n    let params = this.getSearchParams();\n    this.searchService.searchRooms(params).subscribe(res => {\n      this.searchResponse = res;\n      this.searchId = res['search_id'];\n      this.scrollToSearchView();\n      this.spinner.hide();\n    });\n  }\n\n  scrollToSearchView() {\n    let el = document.getElementById('searchTitleId');\n    if (!el) return;\n    let offset = el.getBoundingClientRect().top + window.pageYOffset - 250;\n    window.scrollTo({\n      top: offset,\n      behavior: 'smooth'\n    });\n  }\n\n  onChangeMonth(type) {\n    var _a, _b;\n\n    let classname = type === 'next' ? 'mat-calendar-next-button' : 'mat-calendar-previous-button';\n    let arrows = document.getElementsByClassName(classname);\n    (_a = arrows[0]) === null || _a === void 0 ? void 0 : _a.click();\n    (_b = arrows[1]) === null || _b === void 0 ? void 0 : _b.click();\n    this.updateHeaderText();\n  }\n\n  updateHeaderText() {\n    setTimeout(() => {\n      var _a, _b, _c, _d;\n\n      let btns = document.getElementsByClassName('mat-calendar-period-button');\n      this.calendarOneHeading = (_b = (_a = btns[0]) === null || _a === void 0 ? void 0 : _a.innerText) !== null && _b !== void 0 ? _b : null;\n      this.calendarTwoHeading = (_d = (_c = btns[1]) === null || _c === void 0 ? void 0 : _c.innerText) !== null && _d !== void 0 ? _d : null;\n    }, 0);\n  }\n\n  selectedChange(date) {\n    var _a, _b;\n\n    if (!((_a = this.selectedRangeValue) === null || _a === void 0 ? void 0 : _a.start) || ((_b = this.selectedRangeValue) === null || _b === void 0 ? void 0 : _b.end)) {\n      if (this.dateRangeSelectionType === 'exact') {\n        this.selectedRangeValue = new DateRange(date, null);\n        this.updateDate('checkin', date);\n        this.isCurrentCalendarInputCheckout = true;\n      } else {\n        let days = parseInt(this.dateRangeSelectionType);\n        let checkout = this.addDays(date, days);\n        this.selectedRangeValue = new DateRange(date, checkout);\n        this.updateDate('checkin', date);\n        this.updateDate('checkout', checkout);\n        this.showDropdown = DropdownType.none;\n      }\n    } else {\n      let start = this.selectedRangeValue.start;\n      let end = date;\n\n      if (end < start) {\n        this.selectedRangeValue = new DateRange(end, start);\n        this.updateDate('checkin', end);\n        this.updateDate('checkout', start);\n      } else {\n        this.selectedRangeValue = new DateRange(start, end);\n        this.updateDate('checkin', start);\n        this.updateDate('checkout', end);\n      }\n\n      this.showDropdown = DropdownType.none;\n    }\n\n    this.selectedRangeValueChange.emit(this.selectedRangeValue);\n  }\n\n  updateDate(type, date) {\n    let formatted = moment(date).format('DD/MM/YYYY');\n\n    if (type === 'checkin') {\n      this.searchForm.controls.checkIn.setValue(formatted);\n      this.searchForm.controls.checkOut.setValue(null);\n    } else {\n      this.searchForm.controls.checkOut.setValue(formatted);\n    }\n  }\n\n  addDays(date, days) {\n    let result = new Date(date);\n    result.setDate(result.getDate() + days);\n    return result;\n  }\n\n};\n\n__decorate([Input()], SearchComponent.prototype, \"selectedRangeValue\", void 0);\n\n__decorate([Output()], SearchComponent.prototype, \"selectedRangeValueChange\", void 0);\n\nSearchComponent = __decorate([Component({\n  selector: 'app-search',\n  templateUrl: './search.component.html',\n  styleUrls: ['./search.component.css']\n})], SearchComponent);\nexport { SearchComponent };","map":{"version":3,"sources":["/home/dileep/workspace/cgh-Booking-engine/src/app/pages/search/search.component.ts"],"names":["__decorate","Component","EventEmitter","Input","Output","Validators","debounceTime","map","startWith","moment","DateRange","DropdownType","formatDate","SearchComponent","constructor","searchService","formBuilder","activatedRoute","router","spinner","dealsService","bookingService","bookingConfigService","dropdownType","showDropdown","none","showFieldWarnings","age","Map","agesArray","Array","from","length","_","i","hotelsList","isHotelListLoaded","locationList","isCurrentCalendarInputCheckout","bookingItems","selectedRangeValueChange","now","Date","secondCalStartDate","getFullYear","getMonth","calendarOneHeading","calendarTwoHeading","dateRangeSelectionType","ngOnInit","bookingCart$","subscribe","res","_a","minDate","searchForm","createSearchForm","getWithExpiry","filteredHotelsList","controls","hotel","valueChanges","pipe","value","filterHotel","filteredLocationList","filterLocation","activateRouteSubscription$","queryParams","_b","localStorage","removeItem","roomCount","patchValue","checkIn","checkOut","cityId","stateId","countryId","searchType","setHotelName","parseInt","setLocation","setPaxInfo","fetchSearchResult","roomsFromStorage","Number","getItem","isNaN","rooms","setValue","ngOnDestroy","unsubscribe","dt","tomorrow","setDate","getDate","dtTom","group","location","required","paxData","array","noOfAdults","noOfChildren","getTablesFormArray","get","focusDestinationFieldInput","type","document","getElementById","focus","changeSearchType","val","setValidators","clearValidators","updateValueAndValidity","onHotelFieldEvent","event","setDateRangeSelectionType","filterValue","toString","toLowerCase","filtered","filter","hotel_name","includes","key","setWithExpiry","item","expiry","getTime","setItem","JSON","stringify","getAllHotels","toPromise","then","catch","err","console","error","itemStr","flag","parse","getLocationList","list","forEach","e1","address","city","cityObj","state","country","find","x","push","stateObj","toggleDropdown","checkin","checkout","updateHeaderText","updateRoomCount","removeAt","updateAdultCount","index","room","at","current","updateChildCount","set","delete","addAges","child","target","selectHotel","name","selectLocation","option","id","match","h","hotel_id","loc","getPaxInfo","paxString","guests","arr","c","info","onSubmit","markAllAsTouched","valid","prevUrl","url","params","getSearchParams","navigate","scrollToSearchView","invalid","dirty","touched","bookingEngineId","getBookingEngineId","undefined","hotelId","productId","getProductId","paxInfo","show","searchRooms","searchResponse","searchId","hide","el","offset","getBoundingClientRect","top","window","pageYOffset","scrollTo","behavior","onChangeMonth","classname","arrows","getElementsByClassName","click","setTimeout","_c","_d","btns","innerText","selectedChange","date","selectedRangeValue","start","end","updateDate","days","addDays","emit","formatted","format","result","prototype","selector","templateUrl","styleUrls"],"mappings":"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","sourcesContent":["import { __decorate } from \"tslib\";\nimport { Component, EventEmitter, Input, Output, } from '@angular/core';\nimport { Validators, } from '@angular/forms';\nimport { debounceTime, map, startWith } from 'rxjs/operators';\nimport * as moment from 'moment';\nimport { DateRange } from '@angular/material/datepicker';\nimport { DropdownType } from 'src/app/shared/models/dropdown-type';\nimport { formatDate } from '@angular/common';\nlet SearchComponent = class SearchComponent {\n    constructor(searchService, formBuilder, activatedRoute, router, spinner, dealsService, bookingService, bookingConfigService) {\n        this.searchService = searchService;\n        this.formBuilder = formBuilder;\n        this.activatedRoute = activatedRoute;\n        this.router = router;\n        this.spinner = spinner;\n        this.dealsService = dealsService;\n        this.bookingService = bookingService;\n        this.bookingConfigService = bookingConfigService;\n        this.dropdownType = DropdownType;\n        this.showDropdown = DropdownType.none;\n        this.showFieldWarnings = DropdownType.none;\n        this.age = new Map();\n        this.agesArray = Array.from({ length: 17 }, (_, i) => i + 1);\n        this.hotelsList = [];\n        this.isHotelListLoaded = false;\n        this.locationList = [];\n        this.isCurrentCalendarInputCheckout = false;\n        this.bookingItems = [];\n        this.selectedRangeValueChange = new EventEmitter();\n        this.now = new Date();\n        this.secondCalStartDate = new Date(this.now.getFullYear(), this.now.getMonth() + 1, 1);\n        this.calendarOneHeading = null;\n        this.calendarTwoHeading = null;\n        this.dateRangeSelectionType = 'exact';\n    }\n    ngOnInit() {\n        this.bookingCart$ = this.bookingService.bookingCart$;\n        this.bookingCart$.subscribe((res) => {\n            var _a;\n            this.bookingItems = (_a = res === null || res === void 0 ? void 0 : res.bookingItems) !== null && _a !== void 0 ? _a : [];\n        });\n        this.minDate = new Date();\n        this.searchForm = this.createSearchForm();\n        this.getWithExpiry();\n        this.filteredHotelsList = this.searchForm.controls.hotel.valueChanges.pipe(startWith(''), map((value) => this.filterHotel(value)));\n        this.filteredLocationList =\n            this.searchForm.controls.hotel.valueChanges.pipe(startWith(''), map((value) => this.filterLocation(value)));\n        this.activateRouteSubscription$ =\n            this.activatedRoute.queryParams.pipe(debounceTime(300)).subscribe(async (queryParams) => {\n                var _a, _b;\n                if (!queryParams['checkIn'])\n                    localStorage.removeItem('reflectStore');\n                if (queryParams['checkIn']) {\n                    this.roomCount = queryParams['rooms'];\n                    this.searchForm.patchValue({\n                        checkIn: queryParams['checkIn'],\n                        checkOut: queryParams['checkOut'],\n                        cityId: (_a = queryParams['cityId']) !== null && _a !== void 0 ? _a : '',\n                        stateId: queryParams['stateId'],\n                        countryId: queryParams['countryId'],\n                        searchType: (_b = queryParams['searchType']) !== null && _b !== void 0 ? _b : 'hotel',\n                    });\n                    await this.setHotelName(parseInt(queryParams['productId']));\n                    this.setLocation(queryParams['cityId'], queryParams['stateId']);\n                    this.setPaxInfo(queryParams['paxInfo']);\n                    this.fetchSearchResult();\n                    const roomsFromStorage = Number(localStorage.getItem('rooms'));\n                    if (!isNaN(roomsFromStorage) && roomsFromStorage > 0) {\n                        this.searchForm.controls.rooms.setValue(roomsFromStorage);\n                    }\n                }\n            });\n    }\n    ngOnDestroy() {\n        var _a;\n        (_a = this.activateRouteSubscription$) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n    }\n    createSearchForm() {\n        let dt = formatDate(new Date(), 'dd/MM/yyyy', 'en');\n        const tomorrow = new Date();\n        tomorrow.setDate(tomorrow.getDate() + 1);\n        let dtTom = formatDate(tomorrow, 'dd/MM/yyyy', 'en');\n        return this.formBuilder.group({\n            searchType: ['hotel'],\n            hotel: [''],\n            location: [''],\n            cityId: [''],\n            stateId: [''],\n            countryId: [''],\n            checkIn: [dt, Validators.required],\n            checkOut: [dtTom, Validators.required],\n            rooms: [1],\n            paxData: this.formBuilder.array([\n                this.formBuilder.group({\n                    noOfAdults: 1,\n                    noOfChildren: 0,\n                }),\n            ]),\n        });\n    }\n    getTablesFormArray() {\n        return this.searchForm.get('paxData');\n    }\n    /* ----------------- Missing helper methods requested by template ----------------- */\n    focusDestinationFieldInput(type) {\n        var _a, _b;\n        if (type === 'hotel') {\n            (_a = document.getElementById('hotel-field-input')) === null || _a === void 0 ? void 0 : _a.focus();\n        }\n        else {\n            (_b = document.getElementById('location-field-input')) === null || _b === void 0 ? void 0 : _b.focus();\n        }\n        this.showFieldWarnings = DropdownType.none;\n    }\n    changeSearchType(val) {\n        this.searchForm.controls.searchType.setValue(val);\n        if (val === 'hotel') {\n            this.searchForm.controls.hotel.setValidators([Validators.required]);\n            this.searchForm.controls.location.clearValidators();\n        }\n        else if (val === 'location') {\n            this.searchForm.controls.location.setValidators([Validators.required]);\n            this.searchForm.controls.hotel.clearValidators();\n        }\n        this.searchForm.controls.hotel.updateValueAndValidity();\n        this.searchForm.controls.location.updateValueAndValidity();\n    }\n    onHotelFieldEvent(type, event) {\n        if (!this.isHotelListLoaded) {\n            this.getWithExpiry();\n        }\n        if (type === 'focus' || type === 'keydown') {\n            this.filterHotel(this.searchForm.controls.hotel.value);\n            this.filterLocation(this.searchForm.controls.hotel.value);\n        }\n    }\n    setDateRangeSelectionType(val) {\n        this.dateRangeSelectionType = val;\n    }\n    /* ------------------------------------------------------------------------------- */\n    /** ---------- HOTEL FILTERING ---------- */\n    filterHotel(value) {\n        this.getWithExpiry();\n        if (!value)\n            value = '';\n        let filterValue = (value || '').toString().toLowerCase();\n        let filtered = this.hotelsList.filter((val) => { var _a; return (_a = val.hotel_name) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes(filterValue); });\n        this.showDropdown =\n            filtered.length > 0 ? DropdownType.hotel : DropdownType.none;\n        return filtered;\n    }\n    /** ---------- LOCATION FILTERING ---------- */\n    filterLocation(value) {\n        this.getWithExpiry();\n        if (!value)\n            value = '';\n        let filterValue = (value || '').toString().toLowerCase();\n        let filtered = this.locationList.filter((val) => { var _a; return (_a = val.key) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes(filterValue); });\n        this.showDropdown =\n            filtered.length > 0 ? DropdownType.location : DropdownType.none;\n        return filtered;\n    }\n    /** ---------- CACHE ---------- */\n    setWithExpiry(value) {\n        const item = {\n            value,\n            expiry: new Date().getTime(),\n        };\n        localStorage.setItem('hotel', JSON.stringify(item));\n    }\n    async getAllHotels() {\n        await this.searchService\n            .getAllHotels()\n            .toPromise()\n            .then((res) => {\n            this.setWithExpiry(res['Hotel_Details']);\n            this.getWithExpiry();\n        })\n            .catch((err) => console.error(err));\n    }\n    getWithExpiry() {\n        const itemStr = localStorage.getItem('hotel');\n        if (this.flag == null)\n            this.flag = true;\n        if (!itemStr && this.flag) {\n            this.getAllHotels();\n            this.flag = false;\n            return;\n        }\n        if (itemStr && this.flag) {\n            let item = JSON.parse(itemStr);\n            if (new Date().getTime() > item.expiry) {\n                localStorage.removeItem('hotel');\n                this.getAllHotels();\n                this.flag = false;\n                return;\n            }\n            this.hotelsList = item.value;\n            this.getLocationList(item.value);\n            this.isHotelListLoaded = true;\n        }\n    }\n    /** ---------- LOCATION LIST ---------- */\n    getLocationList(list) {\n        list.forEach((e1) => {\n            var _a, _b;\n            if ((_a = e1.address) === null || _a === void 0 ? void 0 : _a.city) {\n                let cityObj = {\n                    key: e1.address.city,\n                    type: 'city',\n                    cityId: e1.address.cityId,\n                    state: e1.address.state,\n                    stateId: e1.address.stateId,\n                    country: e1.address.country,\n                    countryId: e1.address.countryId,\n                };\n                if (!this.locationList.find((x) => x.key === cityObj.key))\n                    this.locationList.push(cityObj);\n            }\n            if ((_b = e1.address) === null || _b === void 0 ? void 0 : _b.state) {\n                let stateObj = {\n                    key: e1.address.state,\n                    type: 'state',\n                    stateId: e1.address.stateId,\n                    country: e1.address.country,\n                    countryId: e1.address.countryId,\n                };\n                if (!this.locationList.find((x) => x.key === stateObj.key))\n                    this.locationList.push(stateObj);\n            }\n        });\n    }\n    /** ---------- DROPDOWNS ---------- */\n    toggleDropdown(type) {\n        this.showDropdown = this.showDropdown !== type ? type : DropdownType.none;\n        this.showFieldWarnings = DropdownType.none;\n        if (type === DropdownType.checkin || type === DropdownType.checkout) {\n            this.updateHeaderText();\n        }\n    }\n    /** ---------- ROOMS & GUESTS ---------- */\n    updateRoomCount(type) {\n        let rooms = this.searchForm.controls.rooms.value;\n        if (type === 'decrement' && rooms > 1) {\n            this.searchForm.controls.rooms.setValue(rooms - 1);\n            this.getTablesFormArray().removeAt(rooms - 1);\n        }\n        if (type === 'increment') {\n            this.searchForm.controls.rooms.setValue(rooms + 1);\n            this.getTablesFormArray().push(this.formBuilder.group({\n                noOfAdults: 1,\n                noOfChildren: 0,\n            }));\n        }\n        localStorage.setItem('rooms', this.searchForm.controls.rooms.value.toString());\n    }\n    updateAdultCount(type, index) {\n        let room = this.getTablesFormArray().at(index);\n        let current = room.value.noOfAdults;\n        if (type === 'increment')\n            room.patchValue({ noOfAdults: current + 1 });\n        if (type === 'decrement' && current > 1)\n            room.patchValue({ noOfAdults: current - 1 });\n    }\n    updateChildCount(type, index) {\n        let room = this.getTablesFormArray().at(index);\n        let current = room.value.noOfChildren;\n        if (type === 'increment' && current < 3) {\n            room.patchValue({ noOfChildren: current + 1 });\n            this.age.set(`${index}_${current}`, 1);\n        }\n        if (type === 'decrement' && current > 0) {\n            room.patchValue({ noOfChildren: current - 1 });\n            this.age.delete(`${index}_${current - 1}`);\n        }\n    }\n    addAges(event, room, child) {\n        this.age.set(`${room}_${child}`, event.target.value);\n    }\n    /** ---------- SELECTION ---------- */\n    selectHotel(name) {\n        this.searchForm.controls.hotel.setValue(name);\n        this.showDropdown = DropdownType.none;\n    }\n    selectLocation(option) {\n        var _a;\n        this.searchForm.patchValue({\n            hotel: option.key,\n            cityId: (_a = option.cityId) !== null && _a !== void 0 ? _a : '',\n            stateId: option.stateId,\n            countryId: option.countryId,\n            location: option.key,\n            searchType: 'location',\n        });\n        this.showDropdown = DropdownType.none;\n    }\n    async setHotelName(id) {\n        this.getWithExpiry();\n        let match = this.hotelsList.find((h) => h.hotel_id === id);\n        if (match)\n            this.searchForm.controls.hotel.setValue(match.hotel_name);\n    }\n    setLocation(cityId, stateId) {\n        let location = '';\n        for (let loc of this.locationList) {\n            if (cityId && loc.cityId === cityId)\n                location = loc.key;\n            else if (!cityId && loc.stateId === stateId)\n                location = loc.key;\n        }\n        this.searchForm.controls.location.setValue(location);\n    }\n    /** ---------- PAX INFO ---------- */\n    getPaxInfo() {\n        let paxString = '';\n        let guests = 0;\n        let arr = this.getTablesFormArray().value;\n        for (let i = 0; i < arr.length; i++) {\n            paxString += arr[i].noOfAdults + '|' + arr[i].noOfChildren + '|';\n            guests += arr[i].noOfAdults + arr[i].noOfChildren;\n            for (let c = 0; c < arr[i].noOfChildren; c++) {\n                paxString += this.age.get(`${i}_${c}`) + '|';\n            }\n            paxString += '|';\n        }\n        localStorage.setItem('guests', guests.toString());\n        return paxString;\n    }\n    setPaxInfo(info) {\n        // optional (not implemented in original code)\n    }\n    /** ---------- SUBMIT / SEARCH ---------- */\n    onSubmit() {\n        this.searchForm.markAllAsTouched();\n        this.showDropdown = DropdownType.none;\n        if (this.searchForm.valid) {\n            let prevUrl = this.router.url;\n            let params = this.getSearchParams();\n            params.searchType = this.searchForm.controls.searchType.value;\n            this.router.navigate(['/search'], { queryParams: params }).then((res) => {\n                if (prevUrl === this.router.url)\n                    this.scrollToSearchView();\n            });\n        }\n        else {\n            // show validation warnings if needed\n            if (this.searchForm.controls.hotel.invalid &&\n                (this.searchForm.controls.hotel.dirty ||\n                    this.searchForm.controls.hotel.touched)) {\n                this.showFieldWarnings = DropdownType.hotel;\n            }\n            else if (this.searchForm.controls.checkIn.invalid &&\n                (this.searchForm.controls.checkIn.dirty ||\n                    this.searchForm.controls.checkIn.touched)) {\n                this.showFieldWarnings = DropdownType.checkin;\n            }\n            else if (this.searchForm.controls.checkOut.invalid &&\n                (this.searchForm.controls.checkOut.dirty ||\n                    this.searchForm.controls.checkOut.touched)) {\n                this.showFieldWarnings = DropdownType.checkout;\n            }\n        }\n    }\n    getSearchParams() {\n        let params = {\n            bookingEngineId: this.bookingConfigService.getBookingEngineId\n                ? this.bookingConfigService.getBookingEngineId()\n                : undefined,\n            hotelId: this.bookingConfigService.getBookingEngineId\n                ? this.bookingConfigService.getBookingEngineId()\n                : undefined,\n        };\n        params.productId = this.getProductId();\n        params.cityId = this.searchForm.controls.cityId.value;\n        params.checkIn = this.searchForm.controls.checkIn.value;\n        params.checkOut = this.searchForm.controls.checkOut.value;\n        params.paxInfo = this.getPaxInfo();\n        return params;\n    }\n    getProductId() {\n        var _a;\n        let name = this.searchForm.controls.hotel.value;\n        let hotel = this.hotelsList.find((h) => h.hotel_name === name);\n        return (_a = hotel === null || hotel === void 0 ? void 0 : hotel.hotel_id) !== null && _a !== void 0 ? _a : null;\n    }\n    fetchSearchResult() {\n        if (!this.searchForm.valid)\n            return;\n        this.spinner.show();\n        let params = this.getSearchParams();\n        this.searchService.searchRooms(params).subscribe((res) => {\n            this.searchResponse = res;\n            this.searchId = res['search_id'];\n            this.scrollToSearchView();\n            this.spinner.hide();\n        });\n    }\n    scrollToSearchView() {\n        let el = document.getElementById('searchTitleId');\n        if (!el)\n            return;\n        let offset = el.getBoundingClientRect().top + window.pageYOffset - 250;\n        window.scrollTo({\n            top: offset,\n            behavior: 'smooth',\n        });\n    }\n    onChangeMonth(type) {\n        var _a, _b;\n        let classname = type === 'next'\n            ? 'mat-calendar-next-button'\n            : 'mat-calendar-previous-button';\n        let arrows = document.getElementsByClassName(classname);\n        (_a = arrows[0]) === null || _a === void 0 ? void 0 : _a.click();\n        (_b = arrows[1]) === null || _b === void 0 ? void 0 : _b.click();\n        this.updateHeaderText();\n    }\n    updateHeaderText() {\n        setTimeout(() => {\n            var _a, _b, _c, _d;\n            let btns = document.getElementsByClassName('mat-calendar-period-button');\n            this.calendarOneHeading = (_b = (_a = btns[0]) === null || _a === void 0 ? void 0 : _a.innerText) !== null && _b !== void 0 ? _b : null;\n            this.calendarTwoHeading = (_d = (_c = btns[1]) === null || _c === void 0 ? void 0 : _c.innerText) !== null && _d !== void 0 ? _d : null;\n        }, 0);\n    }\n    selectedChange(date) {\n        var _a, _b;\n        if (!((_a = this.selectedRangeValue) === null || _a === void 0 ? void 0 : _a.start) || ((_b = this.selectedRangeValue) === null || _b === void 0 ? void 0 : _b.end)) {\n            if (this.dateRangeSelectionType === 'exact') {\n                this.selectedRangeValue = new DateRange(date, null);\n                this.updateDate('checkin', date);\n                this.isCurrentCalendarInputCheckout = true;\n            }\n            else {\n                let days = parseInt(this.dateRangeSelectionType);\n                let checkout = this.addDays(date, days);\n                this.selectedRangeValue = new DateRange(date, checkout);\n                this.updateDate('checkin', date);\n                this.updateDate('checkout', checkout);\n                this.showDropdown = DropdownType.none;\n            }\n        }\n        else {\n            let start = this.selectedRangeValue.start;\n            let end = date;\n            if (end < start) {\n                this.selectedRangeValue = new DateRange(end, start);\n                this.updateDate('checkin', end);\n                this.updateDate('checkout', start);\n            }\n            else {\n                this.selectedRangeValue = new DateRange(start, end);\n                this.updateDate('checkin', start);\n                this.updateDate('checkout', end);\n            }\n            this.showDropdown = DropdownType.none;\n        }\n        this.selectedRangeValueChange.emit(this.selectedRangeValue);\n    }\n    updateDate(type, date) {\n        let formatted = moment(date).format('DD/MM/YYYY');\n        if (type === 'checkin') {\n            this.searchForm.controls.checkIn.setValue(formatted);\n            this.searchForm.controls.checkOut.setValue(null);\n        }\n        else {\n            this.searchForm.controls.checkOut.setValue(formatted);\n        }\n    }\n    addDays(date, days) {\n        let result = new Date(date);\n        result.setDate(result.getDate() + days);\n        return result;\n    }\n};\n__decorate([\n    Input()\n], SearchComponent.prototype, \"selectedRangeValue\", void 0);\n__decorate([\n    Output()\n], SearchComponent.prototype, \"selectedRangeValueChange\", void 0);\nSearchComponent = __decorate([\n    Component({\n        selector: 'app-search',\n        templateUrl: './search.component.html',\n        styleUrls: ['./search.component.css'],\n    })\n], SearchComponent);\nexport { SearchComponent };\n"]},"metadata":{},"sourceType":"module"}