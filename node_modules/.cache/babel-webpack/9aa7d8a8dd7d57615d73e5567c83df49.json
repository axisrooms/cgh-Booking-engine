{"ast":null,"code":"import _asyncToGenerator from \"/home/dileep/workspace/cgh-Booking-engine/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { debounceTime, map, startWith } from 'rxjs/operators';\nimport * as moment from 'moment';\nimport { DateRange } from '@angular/material/datepicker';\nimport { BOOKING_ENGINE_ID } from 'src/app/shared/constants/url.constants';\nimport { DropdownType } from 'src/app/shared/models/dropdown-type';\nlet SearchComponent = class SearchComponent {\n  constructor(searchService, formBuilder, activatedRoute, router, spinner, dealsService) {\n    this.searchService = searchService;\n    this.formBuilder = formBuilder;\n    this.activatedRoute = activatedRoute;\n    this.router = router;\n    this.spinner = spinner;\n    this.dealsService = dealsService;\n    this.dropdownType = DropdownType;\n    this.agesArray = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];\n    this.hotelsList = [];\n    this.locationList = [];\n    this.minSelectableDate = new Date(); // Today\n\n    this.clearFormArray = formArray => {\n      formArray = this.formBuilder.array([]);\n    };\n\n    this.selectedRangeValueChange = new EventEmitter();\n    this.now = new Date();\n    this.secondCalStartDate = new Date(this.now.getFullYear(), this.now.getMonth() + 1, 1);\n    this.dateRangeSelectionType = 'exact';\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    this.searchForm = this.getsearchForm();\n    this.filteredHotelsList = this.searchForm.controls.hotel.valueChanges.pipe(startWith(''), map(value => this.filterHotel(value)));\n    this.filteredLocationList = this.searchForm.controls.location.valueChanges.pipe(startWith(''), map(value => this.filterLocation(value)));\n    this.searchTypeControlSubscription = this.searchForm.controls.searchType.valueChanges.subscribe(value => {\n      if (value === 'hotel') {\n        this.searchForm.controls.hotel.setValidators([Validators.required]);\n        this.searchForm.controls.location.setValidators(null);\n      }\n\n      if (value === 'location') {\n        this.searchForm.controls.hotel.setValidators(null);\n        this.searchForm.controls.location.setValidators([Validators.required]);\n      }\n    });\n    this.activateRouteSubscription$ = this.activatedRoute.queryParams.pipe(debounceTime(500)).subscribe( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (queryParams) {\n        _this.searchForm.controls.checkIn.setValue(queryParams['checkIn']);\n\n        _this.searchForm.controls.checkOut.setValue(queryParams['checkOut']);\n\n        _this.searchForm.controls.cityId.setValue(queryParams['cityId'] || '');\n\n        _this.searchForm.controls.stateId.setValue(queryParams['stateId']);\n\n        _this.searchForm.controls.countryId.setValue(queryParams['countryId']);\n\n        _this.searchForm.controls.searchType.setValue(queryParams['searchType'] || 'hotel');\n\n        yield _this.setHotelName(parseInt(queryParams['productId']));\n\n        _this.setLocation(queryParams['cityId'], queryParams['stateId']);\n\n        _this.setPaxInfo(queryParams['paxInfo']);\n\n        _this.fetchSearchResult();\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  }\n\n  ngOnDestroy() {\n    this.searchTypeControlSubscription.unsubscribe();\n  }\n\n  getsearchForm() {\n    return this.formBuilder.group({\n      searchType: ['hotel'],\n      hotel: [''],\n      location: [''],\n      cityId: [''],\n      stateId: [''],\n      countryId: [''],\n      checkIn: ['', Validators.required],\n      checkOut: ['', Validators.required],\n      noOfAdults: [1],\n      agesOfChildren: this.formBuilder.array([])\n    });\n  }\n\n  filterHotel(value) {\n    if (!value) value = '';\n    let filterValue = value === null || value === void 0 ? void 0 : value.toLowerCase();\n    let filteredArray = this.hotelsList.filter(val => {\n      var _a;\n\n      return (_a = val.hotel_name) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes(filterValue);\n    });\n    this.showDropdown = filteredArray.length > 0 ? DropdownType.hotel : DropdownType.none;\n    return filteredArray;\n  }\n\n  filterLocation(value) {\n    if (!value) value = '';\n    let filterValue = value === null || value === void 0 ? void 0 : value.toLowerCase();\n    let filteredArray = this.locationList.filter(val => {\n      var _a;\n\n      return (_a = val.key) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes(filterValue);\n    });\n    this.showDropdown = filteredArray.length > 0 ? DropdownType.location : DropdownType.none;\n    return filteredArray;\n  }\n\n  getAllHotels() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this2.searchService.getAllHotels().toPromise().then(res => {\n        _this2.hotelsList = res['Hotel_Details'];\n\n        _this2.getLocationList(res['Hotel_Details']);\n\n        _this2.isHotelListLoaded = true;\n      }).catch(err => console.log(err));\n    })();\n  }\n\n  getLocationList(val) {\n    val.forEach(e1 => {\n      //Push city if available\n      if (e1.address.city) {\n        let obj1 = {\n          key: e1.address.city,\n          type: 'city',\n          cityId: e1.address.cityId,\n          state: e1.address.state,\n          stateId: e1.address.stateId,\n          country: e1.address.country,\n          countryId: e1.address.countryId\n        };\n        let isFound = false;\n\n        for (let index = 0; index < this.locationList.length; index++) {\n          if (this.locationList[index].key === e1.address.city) {\n            isFound = true;\n            break;\n          }\n        }\n\n        if (!isFound) this.locationList.push(obj1);\n      } //Push state\n\n\n      let obj2 = {\n        key: e1.address.state,\n        type: 'state',\n        stateId: e1.address.stateId,\n        country: e1.address.country,\n        countryId: e1.address.countryId\n      };\n      let isFound = false;\n\n      for (let index = 0; index < this.locationList.length; index++) {\n        if (this.locationList[index].key === e1.address.state) {\n          isFound = true;\n          break;\n        }\n      }\n\n      if (!isFound) this.locationList.push(obj2);\n    });\n  }\n\n  toggleDropdown(type) {\n    this.showDropdown = this.showDropdown != type ? type : DropdownType.none;\n    this.showFieldWarnings = this.dropdownType.none;\n\n    if (type === DropdownType.checkin || type === DropdownType.checkout) {\n      this.updateHeaderText();\n    }\n  }\n\n  changeSearchType(val) {\n    this.searchForm.controls.searchType.setValue(val);\n  }\n\n  onHotelFieldEvent(type, event) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      if (!_this3.isHotelListLoaded) {\n        yield _this3.getAllHotels();\n      }\n\n      if (type === 'focus') {\n        _this3.filterHotel(_this3.searchForm.controls.hotel.value);\n      } else if (type === 'keydown') {\n        _this3.filterHotel(_this3.searchForm.controls.hotel.value);\n      }\n    })();\n  }\n\n  onLocationFieldEvent(type, event) {\n    if (type === 'focus') {\n      this.filterLocation(this.searchForm.controls.location.value);\n    } else if (type === 'keydown') {\n      this.filterLocation(this.searchForm.controls.location.value);\n    }\n  } // focusDestinationFieldInput() {\n  //   if (this.searchForm.controls.searchType.value === 'hotel') {\n  //     document.getElementById('hotel-field-input')?.focus();\n  //   } else {\n  //     document.getElementById('location-field-input')?.focus();\n  //   }\n  //   this.showFieldWarnings = this.dropdownType.none;\n  // }\n\n\n  selectHotel(name) {\n    this.searchForm.controls.hotel.setValue(name);\n    setTimeout(() => {\n      var _a;\n\n      (_a = document.getElementById('hotel-field-input')) === null || _a === void 0 ? void 0 : _a.blur();\n      this.showDropdown = DropdownType.none;\n      this.showFieldWarnings = this.dropdownType.none;\n    }, 0);\n  }\n\n  selectLocation(option) {\n    if (option.type = 'city') {\n      this.searchForm.controls.cityId.setValue(option.cityId);\n    }\n\n    this.searchForm.controls.stateId.setValue(option.stateId);\n    this.searchForm.controls.countryId.setValue(option.countryId);\n    this.searchForm.controls.location.setValue(option.key);\n    setTimeout(() => {\n      var _a;\n\n      (_a = document.getElementById('hotel-field-input')) === null || _a === void 0 ? void 0 : _a.blur();\n      this.showDropdown = DropdownType.none;\n      this.showFieldWarnings = this.dropdownType.none;\n    }, 0);\n  }\n\n  setHotelName(id) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      if (!_this4.isHotelListLoaded) {\n        yield _this4.getAllHotels();\n      }\n\n      let hotelName = '';\n\n      for (let i = 0; i < _this4.hotelsList.length; i++) {\n        if (_this4.hotelsList[i].hotel_id === id) {\n          hotelName = _this4.hotelsList[i].hotel_name;\n          break;\n        }\n      }\n\n      _this4.searchForm.controls.hotel.setValue(hotelName);\n    })();\n  }\n\n  setLocation(cityId, stateId) {\n    let location = '';\n\n    for (let index = 0; index < this.locationList.length; index++) {\n      if (cityId) {\n        if (this.locationList[index].cityId === cityId) {\n          location = this.locationList[index]['key'];\n        }\n      } else {\n        if (this.locationList[index].stateId === stateId) {\n          location = this.locationList[index]['key'];\n        }\n      }\n\n      this.searchForm.controls.location.setValue(location);\n    }\n  } //Ages Methods\n\n\n  get agesOfChildren() {\n    return this.searchForm.get('agesOfChildren');\n  }\n\n  getChildrensAgeForm() {\n    return this.formBuilder.group({\n      age: ['', [Validators.required, Validators.pattern(/^[0-9]\\d*$/), Validators.min(1), Validators.max(12)]]\n    });\n  }\n\n  updateChildrensAgeForm(type) {\n    if (type === 'add') {\n      this.agesOfChildren.push(this.getChildrensAgeForm());\n    } else if (type === 'remove') {\n      this.agesOfChildren.removeAt(this.agesOfChildren.length - 1);\n    }\n  }\n\n  updateAdultCount(type) {\n    if (type === 'decrement') {\n      let current = this.searchForm.controls.noOfAdults.value;\n\n      if (current > 1) {\n        this.searchForm.controls.noOfAdults.setValue(current - 1);\n      }\n    } else if (type === 'increment') {\n      let current = this.searchForm.controls.noOfAdults.value;\n      this.searchForm.controls.noOfAdults.setValue(current + 1);\n    }\n  }\n\n  updateChildCount(type) {\n    var _a, _b;\n\n    if (type === 'decrement') {\n      let current = (_b = (_a = this.agesOfChildren) === null || _a === void 0 ? void 0 : _a.controls) === null || _b === void 0 ? void 0 : _b.length;\n\n      if (current > 0) {\n        this.updateChildrensAgeForm('remove');\n      }\n    } else if (type === 'increment') {\n      this.updateChildrensAgeForm('add');\n    }\n  }\n\n  onSubmit() {\n    this.searchForm.markAllAsTouched();\n    this.showDropdown = this.dropdownType.none;\n\n    if (this.searchForm.valid) {\n      let prevUrl = this.router.url.toString();\n      let searchParams = this.getSearchParams();\n      searchParams['searchType'] = this.searchForm.controls.searchType.value;\n      this.router.navigate(['/search'], {\n        queryParams: searchParams\n      }).then(res => {\n        if (prevUrl === this.router.url.toString()) this.scrollToSearchView();\n      });\n    } else {\n      if (this.searchForm.controls.hotel.invalid && (this.searchForm.controls.hotel.dirty || this.searchForm.controls.hotel.touched)) {\n        this.showFieldWarnings = this.dropdownType.hotel;\n      } else if (this.searchForm.controls.checkIn.invalid && (this.searchForm.controls.checkIn.dirty || this.searchForm.controls.checkIn.touched)) {\n        this.showFieldWarnings = this.dropdownType.checkin;\n      } else if (this.searchForm.controls.checkOut.invalid && (this.searchForm.controls.checkOut.dirty || this.searchForm.controls.checkOut.touched)) {\n        this.showFieldWarnings = this.dropdownType.checkout;\n      }\n    }\n  }\n\n  fetchSearchResult() {\n    if (this.searchForm.valid) {\n      this.spinner.show();\n      let searchParams = this.getSearchParams();\n      this.searchService.searchRooms(searchParams).subscribe(res => {\n        this.searchResponse = res;\n        this.searchId = this.searchResponse['search_id'];\n        this.scrollToSearchView();\n        this.spinner.hide();\n      });\n    }\n  }\n\n  scrollToSearchView() {\n    var element = document.getElementById('searchTitleId');\n    var headerOffset = 250;\n    var elementPosition = element === null || element === void 0 ? void 0 : element.getBoundingClientRect().top;\n\n    if (elementPosition) {\n      var offsetPosition = elementPosition + window.pageYOffset - headerOffset;\n      window.scrollTo({\n        top: offsetPosition,\n        behavior: 'smooth'\n      });\n    }\n  }\n\n  getSearchParams() {\n    var _a, _b, _c;\n\n    let searchParams = {\n      bookingEngineId: BOOKING_ENGINE_ID\n    };\n\n    if (this.searchForm.controls.searchType.value === 'hotel') {\n      searchParams.productId = this.getProductId();\n    } else {\n      if (((_a = this.searchForm.controls.cityId.value) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n        searchParams.cityId = this.searchForm.controls.cityId.value;\n      }\n\n      searchParams.stateId = this.searchForm.controls.stateId.value;\n      searchParams.countryId = this.searchForm.controls.countryId.value;\n    }\n\n    if (((_b = this.searchForm.controls.checkIn.value) === null || _b === void 0 ? void 0 : _b.length) > 0) {\n      searchParams.checkIn = this.searchForm.controls.checkIn.value;\n    }\n\n    if (((_c = this.searchForm.controls.checkOut.value) === null || _c === void 0 ? void 0 : _c.length) > 0) {\n      searchParams.checkOut = this.searchForm.controls.checkOut.value;\n    }\n\n    if (this.getPaxInfo()) {\n      searchParams.paxInfo = this.getPaxInfo();\n    }\n\n    return searchParams;\n  }\n\n  getProductId() {\n    let productId;\n\n    for (let i = 0; i < this.hotelsList.length; i++) {\n      if (this.hotelsList[i].hotel_name === this.searchForm.controls.hotel.value) {\n        productId = this.hotelsList[i].hotel_id;\n        break;\n      }\n    }\n\n    return productId;\n  }\n\n  getPaxInfo() {\n    var _a, _b, _c, _d, _e, _f, _g;\n\n    let paxString = this.searchForm.controls.noOfAdults.value + '|' + ((_b = (_a = this.agesOfChildren) === null || _a === void 0 ? void 0 : _a.controls) === null || _b === void 0 ? void 0 : _b.length);\n\n    if (((_d = (_c = this.agesOfChildren) === null || _c === void 0 ? void 0 : _c.controls) === null || _d === void 0 ? void 0 : _d.length) > 0) {\n      for (let i = 0; i < ((_f = (_e = this.agesOfChildren) === null || _e === void 0 ? void 0 : _e.controls) === null || _f === void 0 ? void 0 : _f.length); i++) {\n        paxString += '|' + ((_g = this.agesOfChildren.controls[i].get('age')) === null || _g === void 0 ? void 0 : _g.value);\n      }\n    }\n\n    return paxString;\n  }\n\n  setPaxInfo(paxInfo) {\n    let paxArray = paxInfo ? paxInfo.toString().split('|') : [];\n    this.agesOfChildren.clear();\n    paxArray.forEach((e, i) => {\n      var _a;\n\n      if (i === 0) {\n        this.searchForm.controls.noOfAdults.setValue(parseInt(e));\n      } else if (i > 1) {\n        this.agesOfChildren.push(this.getChildrensAgeForm());\n        (_a = this.agesOfChildren.controls[i - 2].get('age')) === null || _a === void 0 ? void 0 : _a.setValue(parseInt(e));\n      }\n    });\n  }\n\n  onChangeMonth(type) {\n    var className = type === 'next' ? 'mat-calendar-next-button' : 'mat-calendar-previous-button';\n    var classes = document.getElementsByClassName(className);\n    var e1 = classes[0];\n    var e2 = classes[1];\n    e1.click();\n    e2.click();\n    this.updateHeaderText();\n  }\n\n  updateHeaderText() {\n    setTimeout(() => {\n      var _a, _b, _c, _d, _e, _f;\n\n      var cl = document.getElementsByClassName('mat-calendar-period-button');\n      this.calendarOneHeading = (_c = (_b = (_a = cl[0]) === null || _a === void 0 ? void 0 : _a.children[0]) === null || _b === void 0 ? void 0 : _b.children[0]) === null || _c === void 0 ? void 0 : _c.textContent;\n      this.calendarTwoHeading = (_f = (_e = (_d = cl[1]) === null || _d === void 0 ? void 0 : _d.children[0]) === null || _e === void 0 ? void 0 : _e.children[0]) === null || _f === void 0 ? void 0 : _f.textContent;\n    }, 0);\n  }\n\n  selectedChange(m) {\n    var _a, _b;\n\n    this.isCurrentCalendarInputCheckout = false;\n\n    if (!((_a = this.selectedRangeValue) === null || _a === void 0 ? void 0 : _a.start) || ((_b = this.selectedRangeValue) === null || _b === void 0 ? void 0 : _b.end)) {\n      if (this.dateRangeSelectionType != 'exact') {\n        let incDays = parseInt(this.dateRangeSelectionType);\n        this.selectedRangeValue = new DateRange(m, this.addDays(m, incDays));\n        this.updateDateSelection('checkin', m);\n        this.updateDateSelection('checkout', this.addDays(m, incDays));\n        this.showDropdown = DropdownType.none;\n      } else {\n        this.selectedRangeValue = new DateRange(m, null);\n        this.updateDateSelection('checkin', m);\n        this.isCurrentCalendarInputCheckout = true;\n      }\n    } else {\n      const start = this.selectedRangeValue.start;\n      const end = m;\n\n      if (end < start) {\n        this.selectedRangeValue = new DateRange(end, start);\n        this.updateDateSelection('checkin', end);\n        this.updateDateSelection('checkout', start);\n      } else {\n        this.selectedRangeValue = new DateRange(start, end);\n        this.updateDateSelection('checkin', start);\n        this.updateDateSelection('checkout', end);\n      }\n\n      this.showDropdown = DropdownType.none;\n    } // if (!this.selectedRangeValue?.end) {\n    //   this.updateDateSelection('checkin', m);\n    // } else {\n    // }\n\n\n    this.selectedRangeValueChange.emit(this.selectedRangeValue);\n  }\n\n  updateDateSelection(type, event) {\n    let date = moment(event).format('DD/MM/YYYY');\n\n    if (type === 'checkin') {\n      this.searchForm.controls.checkIn.setValue(date);\n      this.searchForm.controls.checkOut.setValue(null);\n    } else if (type === 'checkout') {\n      this.searchForm.controls.checkOut.setValue(date);\n    }\n  }\n\n  setDateRangeSelectionType(val) {\n    this.dateRangeSelectionType = val;\n  }\n\n  addDays(date, days) {\n    var result = new Date(date);\n    result.setDate(result.getDate() + days);\n    return result;\n  }\n\n  focusDestinationFieldInput(type) {\n    // If you want to handle specific behavior when type is 'hotel' or 'location'\n    if (type === 'hotel') {\n      this.showDropdown = this.dropdownType.hotel;\n    }\n\n    if (type === 'location') {\n      // Example: open location dropdown\n      this.showDropdown = this.dropdownType.location;\n    } // Focus the input AFTER Angular updates the DOM\n\n\n    setTimeout(() => {\n      const input = document.getElementById('hotel-field-input');\n      if (input) input.focus();\n    }, 0);\n  }\n\n};\n\n__decorate([Input()], SearchComponent.prototype, \"selectedRangeValue\", void 0);\n\n__decorate([Output()], SearchComponent.prototype, \"selectedRangeValueChange\", void 0);\n\nSearchComponent = __decorate([Component({\n  selector: 'app-search',\n  templateUrl: './search.component.html',\n  styleUrls: ['./search.component.css']\n})], SearchComponent);\nexport { SearchComponent };","map":{"version":3,"sources":["/home/dileep/workspace/cgh-Booking-engine/src/app/pages/search/search.component.ts"],"names":["__decorate","Component","EventEmitter","Input","Output","Validators","debounceTime","map","startWith","moment","DateRange","BOOKING_ENGINE_ID","DropdownType","SearchComponent","constructor","searchService","formBuilder","activatedRoute","router","spinner","dealsService","dropdownType","agesArray","hotelsList","locationList","minSelectableDate","Date","clearFormArray","formArray","array","selectedRangeValueChange","now","secondCalStartDate","getFullYear","getMonth","dateRangeSelectionType","ngOnInit","searchForm","getsearchForm","filteredHotelsList","controls","hotel","valueChanges","pipe","value","filterHotel","filteredLocationList","location","filterLocation","searchTypeControlSubscription","searchType","subscribe","setValidators","required","activateRouteSubscription$","queryParams","checkIn","setValue","checkOut","cityId","stateId","countryId","setHotelName","parseInt","setLocation","setPaxInfo","fetchSearchResult","ngOnDestroy","unsubscribe","group","noOfAdults","agesOfChildren","filterValue","toLowerCase","filteredArray","filter","val","_a","hotel_name","includes","showDropdown","length","none","key","getAllHotels","toPromise","then","res","getLocationList","isHotelListLoaded","catch","err","console","log","forEach","e1","address","city","obj1","type","state","country","isFound","index","push","obj2","toggleDropdown","showFieldWarnings","checkin","checkout","updateHeaderText","changeSearchType","onHotelFieldEvent","event","onLocationFieldEvent","selectHotel","name","setTimeout","document","getElementById","blur","selectLocation","option","id","hotelName","i","hotel_id","get","getChildrensAgeForm","age","pattern","min","max","updateChildrensAgeForm","removeAt","updateAdultCount","current","updateChildCount","_b","onSubmit","markAllAsTouched","valid","prevUrl","url","toString","searchParams","getSearchParams","navigate","scrollToSearchView","invalid","dirty","touched","show","searchRooms","searchResponse","searchId","hide","element","headerOffset","elementPosition","getBoundingClientRect","top","offsetPosition","window","pageYOffset","scrollTo","behavior","_c","bookingEngineId","productId","getProductId","getPaxInfo","paxInfo","_d","_e","_f","_g","paxString","paxArray","split","clear","e","onChangeMonth","className","classes","getElementsByClassName","e2","click","cl","calendarOneHeading","children","textContent","calendarTwoHeading","selectedChange","m","isCurrentCalendarInputCheckout","selectedRangeValue","start","end","incDays","addDays","updateDateSelection","emit","date","format","setDateRangeSelectionType","days","result","setDate","getDate","focusDestinationFieldInput","input","focus","prototype","selector","templateUrl","styleUrls"],"mappings":"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","sourcesContent":["import { __decorate } from \"tslib\";\nimport { Component, EventEmitter, Input, Output, } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { debounceTime, map, startWith } from 'rxjs/operators';\nimport * as moment from 'moment';\nimport { DateRange } from '@angular/material/datepicker';\nimport { BOOKING_ENGINE_ID } from 'src/app/shared/constants/url.constants';\nimport { DropdownType } from 'src/app/shared/models/dropdown-type';\nlet SearchComponent = class SearchComponent {\n    constructor(searchService, formBuilder, activatedRoute, router, spinner, dealsService) {\n        this.searchService = searchService;\n        this.formBuilder = formBuilder;\n        this.activatedRoute = activatedRoute;\n        this.router = router;\n        this.spinner = spinner;\n        this.dealsService = dealsService;\n        this.dropdownType = DropdownType;\n        this.agesArray = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];\n        this.hotelsList = [];\n        this.locationList = [];\n        this.minSelectableDate = new Date(); // Today\n        this.clearFormArray = (formArray) => {\n            formArray = this.formBuilder.array([]);\n        };\n        this.selectedRangeValueChange = new EventEmitter();\n        this.now = new Date();\n        this.secondCalStartDate = new Date(this.now.getFullYear(), this.now.getMonth() + 1, 1);\n        this.dateRangeSelectionType = 'exact';\n    }\n    ngOnInit() {\n        this.searchForm = this.getsearchForm();\n        this.filteredHotelsList = this.searchForm.controls.hotel.valueChanges.pipe(startWith(''), map((value) => this.filterHotel(value)));\n        this.filteredLocationList =\n            this.searchForm.controls.location.valueChanges.pipe(startWith(''), map((value) => this.filterLocation(value)));\n        this.searchTypeControlSubscription =\n            this.searchForm.controls.searchType.valueChanges.subscribe((value) => {\n                if (value === 'hotel') {\n                    this.searchForm.controls.hotel.setValidators([Validators.required]);\n                    this.searchForm.controls.location.setValidators(null);\n                }\n                if (value === 'location') {\n                    this.searchForm.controls.hotel.setValidators(null);\n                    this.searchForm.controls.location.setValidators([\n                        Validators.required,\n                    ]);\n                }\n            });\n        this.activateRouteSubscription$ = this.activatedRoute.queryParams.pipe(debounceTime(500)).subscribe(async (queryParams) => {\n            this.searchForm.controls.checkIn.setValue(queryParams['checkIn']);\n            this.searchForm.controls.checkOut.setValue(queryParams['checkOut']);\n            this.searchForm.controls.cityId.setValue(queryParams['cityId'] || '');\n            this.searchForm.controls.stateId.setValue(queryParams['stateId']);\n            this.searchForm.controls.countryId.setValue(queryParams['countryId']);\n            this.searchForm.controls.searchType.setValue(queryParams['searchType'] || 'hotel');\n            await this.setHotelName(parseInt(queryParams['productId']));\n            this.setLocation(queryParams['cityId'], queryParams['stateId']);\n            this.setPaxInfo(queryParams['paxInfo']);\n            this.fetchSearchResult();\n        });\n    }\n    ngOnDestroy() {\n        this.searchTypeControlSubscription.unsubscribe();\n    }\n    getsearchForm() {\n        return this.formBuilder.group({\n            searchType: ['hotel'],\n            hotel: [''],\n            location: [''],\n            cityId: [''],\n            stateId: [''],\n            countryId: [''],\n            checkIn: ['', Validators.required],\n            checkOut: ['', Validators.required],\n            noOfAdults: [1],\n            agesOfChildren: this.formBuilder.array([]),\n        });\n    }\n    filterHotel(value) {\n        if (!value)\n            value = '';\n        let filterValue = value === null || value === void 0 ? void 0 : value.toLowerCase();\n        let filteredArray = this.hotelsList.filter((val) => { var _a; return (_a = val.hotel_name) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes(filterValue); });\n        this.showDropdown =\n            filteredArray.length > 0 ? DropdownType.hotel : DropdownType.none;\n        return filteredArray;\n    }\n    filterLocation(value) {\n        if (!value)\n            value = '';\n        let filterValue = value === null || value === void 0 ? void 0 : value.toLowerCase();\n        let filteredArray = this.locationList.filter((val) => { var _a; return (_a = val.key) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes(filterValue); });\n        this.showDropdown =\n            filteredArray.length > 0 ? DropdownType.location : DropdownType.none;\n        return filteredArray;\n    }\n    async getAllHotels() {\n        await this.searchService\n            .getAllHotels()\n            .toPromise()\n            .then((res) => {\n            this.hotelsList = res['Hotel_Details'];\n            this.getLocationList(res['Hotel_Details']);\n            this.isHotelListLoaded = true;\n        })\n            .catch((err) => console.log(err));\n    }\n    getLocationList(val) {\n        val.forEach((e1) => {\n            //Push city if available\n            if (e1.address.city) {\n                let obj1 = {\n                    key: e1.address.city,\n                    type: 'city',\n                    cityId: e1.address.cityId,\n                    state: e1.address.state,\n                    stateId: e1.address.stateId,\n                    country: e1.address.country,\n                    countryId: e1.address.countryId,\n                };\n                let isFound = false;\n                for (let index = 0; index < this.locationList.length; index++) {\n                    if (this.locationList[index].key === e1.address.city) {\n                        isFound = true;\n                        break;\n                    }\n                }\n                if (!isFound)\n                    this.locationList.push(obj1);\n            }\n            //Push state\n            let obj2 = {\n                key: e1.address.state,\n                type: 'state',\n                stateId: e1.address.stateId,\n                country: e1.address.country,\n                countryId: e1.address.countryId,\n            };\n            let isFound = false;\n            for (let index = 0; index < this.locationList.length; index++) {\n                if (this.locationList[index].key === e1.address.state) {\n                    isFound = true;\n                    break;\n                }\n            }\n            if (!isFound)\n                this.locationList.push(obj2);\n        });\n    }\n    toggleDropdown(type) {\n        this.showDropdown = this.showDropdown != type ? type : DropdownType.none;\n        this.showFieldWarnings = this.dropdownType.none;\n        if (type === DropdownType.checkin || type === DropdownType.checkout) {\n            this.updateHeaderText();\n        }\n    }\n    changeSearchType(val) {\n        this.searchForm.controls.searchType.setValue(val);\n    }\n    async onHotelFieldEvent(type, event) {\n        if (!this.isHotelListLoaded) {\n            await this.getAllHotels();\n        }\n        if (type === 'focus') {\n            this.filterHotel(this.searchForm.controls.hotel.value);\n        }\n        else if (type === 'keydown') {\n            this.filterHotel(this.searchForm.controls.hotel.value);\n        }\n    }\n    onLocationFieldEvent(type, event) {\n        if (type === 'focus') {\n            this.filterLocation(this.searchForm.controls.location.value);\n        }\n        else if (type === 'keydown') {\n            this.filterLocation(this.searchForm.controls.location.value);\n        }\n    }\n    // focusDestinationFieldInput() {\n    //   if (this.searchForm.controls.searchType.value === 'hotel') {\n    //     document.getElementById('hotel-field-input')?.focus();\n    //   } else {\n    //     document.getElementById('location-field-input')?.focus();\n    //   }\n    //   this.showFieldWarnings = this.dropdownType.none;\n    // }\n    selectHotel(name) {\n        this.searchForm.controls.hotel.setValue(name);\n        setTimeout(() => {\n            var _a;\n            (_a = document.getElementById('hotel-field-input')) === null || _a === void 0 ? void 0 : _a.blur();\n            this.showDropdown = DropdownType.none;\n            this.showFieldWarnings = this.dropdownType.none;\n        }, 0);\n    }\n    selectLocation(option) {\n        if ((option.type = 'city')) {\n            this.searchForm.controls.cityId.setValue(option.cityId);\n        }\n        this.searchForm.controls.stateId.setValue(option.stateId);\n        this.searchForm.controls.countryId.setValue(option.countryId);\n        this.searchForm.controls.location.setValue(option.key);\n        setTimeout(() => {\n            var _a;\n            (_a = document.getElementById('hotel-field-input')) === null || _a === void 0 ? void 0 : _a.blur();\n            this.showDropdown = DropdownType.none;\n            this.showFieldWarnings = this.dropdownType.none;\n        }, 0);\n    }\n    async setHotelName(id) {\n        if (!this.isHotelListLoaded) {\n            await this.getAllHotels();\n        }\n        let hotelName = '';\n        for (let i = 0; i < this.hotelsList.length; i++) {\n            if (this.hotelsList[i].hotel_id === id) {\n                hotelName = this.hotelsList[i].hotel_name;\n                break;\n            }\n        }\n        this.searchForm.controls.hotel.setValue(hotelName);\n    }\n    setLocation(cityId, stateId) {\n        let location = '';\n        for (let index = 0; index < this.locationList.length; index++) {\n            if (cityId) {\n                if (this.locationList[index].cityId === cityId) {\n                    location = this.locationList[index]['key'];\n                }\n            }\n            else {\n                if (this.locationList[index].stateId === stateId) {\n                    location = this.locationList[index]['key'];\n                }\n            }\n            this.searchForm.controls.location.setValue(location);\n        }\n    }\n    //Ages Methods\n    get agesOfChildren() {\n        return this.searchForm.get('agesOfChildren');\n    }\n    getChildrensAgeForm() {\n        return this.formBuilder.group({\n            age: [\n                '',\n                [\n                    Validators.required,\n                    Validators.pattern(/^[0-9]\\d*$/),\n                    Validators.min(1),\n                    Validators.max(12),\n                ],\n            ],\n        });\n    }\n    updateChildrensAgeForm(type) {\n        if (type === 'add') {\n            this.agesOfChildren.push(this.getChildrensAgeForm());\n        }\n        else if (type === 'remove') {\n            this.agesOfChildren.removeAt(this.agesOfChildren.length - 1);\n        }\n    }\n    updateAdultCount(type) {\n        if (type === 'decrement') {\n            let current = this.searchForm.controls.noOfAdults.value;\n            if (current > 1) {\n                this.searchForm.controls.noOfAdults.setValue(current - 1);\n            }\n        }\n        else if (type === 'increment') {\n            let current = this.searchForm.controls.noOfAdults.value;\n            this.searchForm.controls.noOfAdults.setValue(current + 1);\n        }\n    }\n    updateChildCount(type) {\n        var _a, _b;\n        if (type === 'decrement') {\n            let current = (_b = (_a = this.agesOfChildren) === null || _a === void 0 ? void 0 : _a.controls) === null || _b === void 0 ? void 0 : _b.length;\n            if (current > 0) {\n                this.updateChildrensAgeForm('remove');\n            }\n        }\n        else if (type === 'increment') {\n            this.updateChildrensAgeForm('add');\n        }\n    }\n    onSubmit() {\n        this.searchForm.markAllAsTouched();\n        this.showDropdown = this.dropdownType.none;\n        if (this.searchForm.valid) {\n            let prevUrl = this.router.url.toString();\n            let searchParams = this.getSearchParams();\n            searchParams['searchType'] = this.searchForm.controls.searchType.value;\n            this.router\n                .navigate(['/search'], { queryParams: searchParams })\n                .then((res) => {\n                if (prevUrl === this.router.url.toString())\n                    this.scrollToSearchView();\n            });\n        }\n        else {\n            if (this.searchForm.controls.hotel.invalid &&\n                (this.searchForm.controls.hotel.dirty ||\n                    this.searchForm.controls.hotel.touched)) {\n                this.showFieldWarnings = this.dropdownType.hotel;\n            }\n            else if (this.searchForm.controls.checkIn.invalid &&\n                (this.searchForm.controls.checkIn.dirty ||\n                    this.searchForm.controls.checkIn.touched)) {\n                this.showFieldWarnings = this.dropdownType.checkin;\n            }\n            else if (this.searchForm.controls.checkOut.invalid &&\n                (this.searchForm.controls.checkOut.dirty ||\n                    this.searchForm.controls.checkOut.touched)) {\n                this.showFieldWarnings = this.dropdownType.checkout;\n            }\n        }\n    }\n    fetchSearchResult() {\n        if (this.searchForm.valid) {\n            this.spinner.show();\n            let searchParams = this.getSearchParams();\n            this.searchService.searchRooms(searchParams).subscribe((res) => {\n                this.searchResponse = res;\n                this.searchId = this.searchResponse['search_id'];\n                this.scrollToSearchView();\n                this.spinner.hide();\n            });\n        }\n    }\n    scrollToSearchView() {\n        var element = document.getElementById('searchTitleId');\n        var headerOffset = 250;\n        var elementPosition = element === null || element === void 0 ? void 0 : element.getBoundingClientRect().top;\n        if (elementPosition) {\n            var offsetPosition = elementPosition + window.pageYOffset - headerOffset;\n            window.scrollTo({\n                top: offsetPosition,\n                behavior: 'smooth',\n            });\n        }\n    }\n    getSearchParams() {\n        var _a, _b, _c;\n        let searchParams = {\n            bookingEngineId: BOOKING_ENGINE_ID,\n        };\n        if (this.searchForm.controls.searchType.value === 'hotel') {\n            searchParams.productId = this.getProductId();\n        }\n        else {\n            if (((_a = this.searchForm.controls.cityId.value) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n                searchParams.cityId = this.searchForm.controls.cityId.value;\n            }\n            searchParams.stateId = this.searchForm.controls.stateId.value;\n            searchParams.countryId = this.searchForm.controls.countryId.value;\n        }\n        if (((_b = this.searchForm.controls.checkIn.value) === null || _b === void 0 ? void 0 : _b.length) > 0) {\n            searchParams.checkIn = this.searchForm.controls.checkIn.value;\n        }\n        if (((_c = this.searchForm.controls.checkOut.value) === null || _c === void 0 ? void 0 : _c.length) > 0) {\n            searchParams.checkOut = this.searchForm.controls.checkOut.value;\n        }\n        if (this.getPaxInfo()) {\n            searchParams.paxInfo = this.getPaxInfo();\n        }\n        return searchParams;\n    }\n    getProductId() {\n        let productId;\n        for (let i = 0; i < this.hotelsList.length; i++) {\n            if (this.hotelsList[i].hotel_name === this.searchForm.controls.hotel.value) {\n                productId = this.hotelsList[i].hotel_id;\n                break;\n            }\n        }\n        return productId;\n    }\n    getPaxInfo() {\n        var _a, _b, _c, _d, _e, _f, _g;\n        let paxString = this.searchForm.controls.noOfAdults.value +\n            '|' +\n            ((_b = (_a = this.agesOfChildren) === null || _a === void 0 ? void 0 : _a.controls) === null || _b === void 0 ? void 0 : _b.length);\n        if (((_d = (_c = this.agesOfChildren) === null || _c === void 0 ? void 0 : _c.controls) === null || _d === void 0 ? void 0 : _d.length) > 0) {\n            for (let i = 0; i < ((_f = (_e = this.agesOfChildren) === null || _e === void 0 ? void 0 : _e.controls) === null || _f === void 0 ? void 0 : _f.length); i++) {\n                paxString += '|' + ((_g = this.agesOfChildren.controls[i].get('age')) === null || _g === void 0 ? void 0 : _g.value);\n            }\n        }\n        return paxString;\n    }\n    setPaxInfo(paxInfo) {\n        let paxArray = paxInfo ? paxInfo.toString().split('|') : [];\n        this.agesOfChildren.clear();\n        paxArray.forEach((e, i) => {\n            var _a;\n            if (i === 0) {\n                this.searchForm.controls.noOfAdults.setValue(parseInt(e));\n            }\n            else if (i > 1) {\n                this.agesOfChildren.push(this.getChildrensAgeForm());\n                (_a = this.agesOfChildren.controls[i - 2].get('age')) === null || _a === void 0 ? void 0 : _a.setValue(parseInt(e));\n            }\n        });\n    }\n    onChangeMonth(type) {\n        var className = type === 'next'\n            ? 'mat-calendar-next-button'\n            : 'mat-calendar-previous-button';\n        var classes = document.getElementsByClassName(className);\n        var e1 = classes[0];\n        var e2 = classes[1];\n        e1.click();\n        e2.click();\n        this.updateHeaderText();\n    }\n    updateHeaderText() {\n        setTimeout(() => {\n            var _a, _b, _c, _d, _e, _f;\n            var cl = document.getElementsByClassName('mat-calendar-period-button');\n            this.calendarOneHeading = (_c = (_b = (_a = cl[0]) === null || _a === void 0 ? void 0 : _a.children[0]) === null || _b === void 0 ? void 0 : _b.children[0]) === null || _c === void 0 ? void 0 : _c.textContent;\n            this.calendarTwoHeading = (_f = (_e = (_d = cl[1]) === null || _d === void 0 ? void 0 : _d.children[0]) === null || _e === void 0 ? void 0 : _e.children[0]) === null || _f === void 0 ? void 0 : _f.textContent;\n        }, 0);\n    }\n    selectedChange(m) {\n        var _a, _b;\n        this.isCurrentCalendarInputCheckout = false;\n        if (!((_a = this.selectedRangeValue) === null || _a === void 0 ? void 0 : _a.start) || ((_b = this.selectedRangeValue) === null || _b === void 0 ? void 0 : _b.end)) {\n            if (this.dateRangeSelectionType != 'exact') {\n                let incDays = parseInt(this.dateRangeSelectionType);\n                this.selectedRangeValue = new DateRange(m, this.addDays(m, incDays));\n                this.updateDateSelection('checkin', m);\n                this.updateDateSelection('checkout', this.addDays(m, incDays));\n                this.showDropdown = DropdownType.none;\n            }\n            else {\n                this.selectedRangeValue = new DateRange(m, null);\n                this.updateDateSelection('checkin', m);\n                this.isCurrentCalendarInputCheckout = true;\n            }\n        }\n        else {\n            const start = this.selectedRangeValue.start;\n            const end = m;\n            if (end < start) {\n                this.selectedRangeValue = new DateRange(end, start);\n                this.updateDateSelection('checkin', end);\n                this.updateDateSelection('checkout', start);\n            }\n            else {\n                this.selectedRangeValue = new DateRange(start, end);\n                this.updateDateSelection('checkin', start);\n                this.updateDateSelection('checkout', end);\n            }\n            this.showDropdown = DropdownType.none;\n        }\n        // if (!this.selectedRangeValue?.end) {\n        //   this.updateDateSelection('checkin', m);\n        // } else {\n        // }\n        this.selectedRangeValueChange.emit(this.selectedRangeValue);\n    }\n    updateDateSelection(type, event) {\n        let date = moment(event).format('DD/MM/YYYY');\n        if (type === 'checkin') {\n            this.searchForm.controls.checkIn.setValue(date);\n            this.searchForm.controls.checkOut.setValue(null);\n        }\n        else if (type === 'checkout') {\n            this.searchForm.controls.checkOut.setValue(date);\n        }\n    }\n    setDateRangeSelectionType(val) {\n        this.dateRangeSelectionType = val;\n    }\n    addDays(date, days) {\n        var result = new Date(date);\n        result.setDate(result.getDate() + days);\n        return result;\n    }\n    focusDestinationFieldInput(type) {\n        // If you want to handle specific behavior when type is 'hotel' or 'location'\n        if (type === 'hotel') {\n            this.showDropdown = this.dropdownType.hotel;\n        }\n        if (type === 'location') {\n            // Example: open location dropdown\n            this.showDropdown = this.dropdownType.location;\n        }\n        // Focus the input AFTER Angular updates the DOM\n        setTimeout(() => {\n            const input = document.getElementById('hotel-field-input');\n            if (input)\n                input.focus();\n        }, 0);\n    }\n};\n__decorate([\n    Input()\n], SearchComponent.prototype, \"selectedRangeValue\", void 0);\n__decorate([\n    Output()\n], SearchComponent.prototype, \"selectedRangeValueChange\", void 0);\nSearchComponent = __decorate([\n    Component({\n        selector: 'app-search',\n        templateUrl: './search.component.html',\n        styleUrls: ['./search.component.css'],\n    })\n], SearchComponent);\nexport { SearchComponent };\n"]},"metadata":{},"sourceType":"module"}